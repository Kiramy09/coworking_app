<div class="admin-space-container" *ngIf="space">
    <h2 class="mb-4 text-center fw-bold text-uppercase">Gérer l’espace : {{ space.name }}</h2>
  
    <!-- Image seule au-dessus -->
    <div *ngIf="space.image" class="space-image mb-4">
      <img [src]="space.image" alt="Image de l'espace" class="rounded shadow-sm w-100">
    </div>

    <!-- Modal de confirmation suppression -->
    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4">
            <div class="modal-body">
            <i class="bi bi-exclamation-triangle-fill text-danger display-4 mb-3"></i>
            <h4 class="mb-2">Supprimer l’espace ?</h4>
            <p class="text-muted">Cette action est irréversible.</p>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-secondary w-50" data-bs-dismiss="modal">Annuler</button>
                <button class="btn btn-danger w-50" (click)="deleteSpace()">Supprimer</button>
            </div>
            </div>
        </div>
        </div>
    </div>

    <!-- Modal de confirmation suppression réservation -->
    <div class="modal fade" id="confirmDeleteReservationModal" tabindex="-1" aria-labelledby="deleteReservationLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4">
            <div class="modal-body">
            <i class="bi bi-exclamation-triangle-fill text-danger display-4 mb-3"></i>
            <h4 class="mb-2">Supprimer cette réservation ?</h4>
            <p class="text-muted">Cette action est définitive.</p>
            <div class="d-flex gap-2 mt-3">
                <button class="btn btn-secondary w-50" data-bs-dismiss="modal">Annuler</button>
                <button class="btn btn-danger w-50" (click)="confirmReservationDeletion()">Supprimer</button>
            </div>
            </div>
        </div>
        </div>
    </div>
  
    <!-- Row contenant les deux cartes côte à côte -->
    <div class="row g-4">
      <!-- Colonne : Détails -->
        <!-- Modal de succès après mise à jour -->
        <div class="modal fade" id="updateSuccessModal" tabindex="-1" aria-labelledby="updateSuccessModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4">
                <div class="modal-body">
                <i class="bi bi-check-circle-fill text-success display-4 mb-3"></i>
                <h4 class="mb-2">Modifications enregistrées !</h4>
                <p class="text-muted">Les changements ont été sauvegardés avec succès.</p>
                <button class="btn btn-success w-100 mt-3" data-bs-dismiss="modal">Fermer</button>
                </div>
            </div>
            </div>
        </div>

  
      <div class="col-md-6">
        <div class="card shadow border-0 p-4 h-100 rounded-4">
          <h4 class="mb-3 text-primary">
            <i class="bi bi-info-circle-fill me-2"></i>Détails de l’espace
          </h4>
            <div *ngIf="!editMode">
                <p><i class="bi bi-geo-alt-fill text-danger me-2"></i><strong>Adresse :</strong> {{ space.address }}</p>
                <p><i class="bi bi-people-fill text-purple me-2"></i><strong>Capacité :</strong> {{ space.capacity }} personnes</p>
                <p><i class="bi bi-cash-coin text-success me-2"></i><strong>Tarif :</strong> {{ space.price_per_hour }} €/heure</p>
                <p><i class="bi bi-card-text text-muted me-2"></i><strong>Description :</strong><br> {{ space.description }}</p>
            </div>

          <form *ngIf="editMode" (ngSubmit)="saveChanges()" class="mb-4">

            <div class="mb-3">
                <label class="form-label fw-bold">Image</label>
                <input 
                  type="file" 
                  class="form-control" 
                  (change)="onImageSelected($event)">
            </div>
              
            <div class="mb-3">
              <label class="form-label fw-bold">Nom de l’espace</label>
              <input class="form-control" [(ngModel)]="editForm.name" name="name" required>
            </div>
          
            <div class="mb-3">
              <label class="form-label fw-bold">Adresse</label>
              <input class="form-control" [(ngModel)]="editForm.address" name="address" required>
            </div>
          
            <div class="mb-3">
              <label class="form-label fw-bold">Capacité</label>
              <input type="number" class="form-control" [(ngModel)]="editForm.capacity" name="capacity" required>
            </div>
          
            <div class="mb-3">
              <label class="form-label fw-bold">Tarif (€/heure)</label>
              <input type="number" class="form-control" [(ngModel)]="editForm.price_per_hour" name="price_per_hour" required>
            </div>
          
            <div class="mb-3">
              <label class="form-label fw-bold">Description</label>
              <textarea class="form-control" rows="4" [(ngModel)]="editForm.description" name="description"></textarea>
            </div>

            <!-- Liste des équipements en édition -->
            <div *ngIf="editMode" class="mb-3">
                <label class="form-label fw-bold">Équipements</label>
                <div class="form-check" *ngFor="let e of allEquipments">
                <input
                    type="checkbox"
                    class="form-check-input"
                    [id]="'equip-' + e.id"
                    [value]="e.id"
                    [(ngModel)]="e.checked"
                    name="equipments"
                />
                <label class="form-check-label" [for]="'equip-' + e.id">{{ e.name }}</label>
                </div>
            </div>
          
            <button type="submit" class="btn btn-success">
              <i class="bi bi-check-circle me-1"></i> Enregistrer les modifications
            </button>
          </form>
  
            <!-- Affichage des équipements en mode lecture -->
            <div *ngIf="!editMode && space.equipments?.length" class="mt-3">
                <h6 class="fw-bold"><i class="bi bi-tools me-2"></i>Équipements :</h6>
                <ul class="list-unstyled ms-3">
                  <li *ngFor="let e of space.equipments_info">– {{ e.name }}</li>

                <!-- <li *ngFor="let e of space.equipments">– {{ e.name }}</li> -->
                </ul>
            </div>
            
  
          <div class="mt-4 d-flex flex-wrap gap-2">
            <!-- Bouton Modifier -->
            <button class="btn btn-outline-primary" (click)="toggleEdit()">
                <i class="bi bi-pencil-square me-1"></i>
                {{ editMode ? 'Annuler' : 'Modifier cet espace' }}
            </button>
            
            <button 
                class="btn btn-outline-secondary" 
                (click)="toggleVisibility()">
                <i class="bi" 
                [ngClass]="space.is_visible ? 'bi-eye-slash' : 'bi-eye'"></i>
                {{ space.is_visible ? 'Masquer cet espace' : 'Afficher cet espace' }}
            </button>
          
            <button class="btn btn-outline-danger" (click)="confirmDelete()">
                <i class="bi bi-trash me-1"></i> Supprimer
              </button>
              
          </div>
        </div>
      </div>

      <!-- Modal de succès -->
    <div class="modal fade" id="visibilityModal" tabindex="-1" aria-labelledby="visibilityModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center p-4">
            <div class="modal-body">
            <i class="bi bi-check-circle-fill text-success display-4 mb-3"></i>
            <h4 class="mb-2">Visibilité mise à jour !</h4>
            <p class="text-muted">
                L’espace a été {{ space?.is_visible ? 'rendu visible' : 'masqué' }} avec succès.
            </p>
            <button class="btn btn-success w-100 mt-3" data-bs-dismiss="modal">Fermer</button>
            </div>
        </div>
        </div>
    </div>
  
      <!-- Colonne : Réservations -->
      <div class="col-md-6">
        <div class="card shadow border-0 p-4 h-100 rounded-4">
          <h4 class="mb-3 text-primary"><i class="bi bi-calendar-event me-2"></i>Réservations à venir</h4>
  
          <div *ngIf="reservations.length === 0" class="text-muted">
            Aucune réservation à venir.
          </div>
  
          <ul class="list-group list-group-flush" *ngIf="reservations.length > 0">
            <li 
              class="list-group-item d-flex justify-content-between align-items-center" 
              *ngFor="let r of reservations"
            >
              <div>
                <strong>{{ r.customer_email }}</strong><br>
                {{ r.start_time | date: 'short' }} → {{ r.end_time | date: 'short' }}
              </div>
              <span 
                class="badge"
                [ngClass]="{
                  'bg-success': r.is_paid,
                  'bg-warning text-dark': !r.is_paid
                }"
              >
                {{ r.is_paid ? 'Payé' : 'Non payé' }}
              </span>
              <button class="btn btn-sm btn-outline-danger" (click)="deleteReservation(r.id)" title="Supprimer cette réservation">
                <i class="bi bi-trash"></i>
              </button>
            
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  